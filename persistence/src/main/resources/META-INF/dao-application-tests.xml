<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:jpa="http://www.springframework.org/schema/data/jpa"
       xmlns:utils="http://www.springframework.org/schema/util"

       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/data/jpa
http://www.springframework.org/schema/data/jpa/spring-jpa.xsd

 http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"
       profile="application-tests">

    <utils:list id="listOfPackagesToScan">
        <value>mobi.nowtechnologies.server.persistence.domain</value>
        <value>mobi.nowtechnologies.server.persistence.apptests.domain</value>
    </utils:list>

    <utils:properties id="jpaProperties">
        <prop key="hibernate.show_sql">false</prop>
        <prop key="hibernate.generate_statistics">true</prop>
    </utils:properties>

    <jpa:repositories base-package="mobi.nowtechnologies.server.persistence.apptests.repository"
                      entity-manager-factory-ref="persistence.EntityManagerFactory"
                      transaction-manager-ref="persistence.TransactionManager">
    </jpa:repositories>

    <bean id="persistence.DataSource" destroy-method="close" class="org.apache.commons.dbcp.BasicDataSource">
        <property name="removeAbandoned" value="${application.tests.jdbc.removeAbandoned}" />
        <property name="removeAbandonedTimeout" value="${application.tests.jdbc.removeAbandonedTimeout}" />
        <property name="testOnBorrow" value="${application.tests.jdbc.testOnBorrow}" />
        <property name="validationQuery" value="${application.tests.jdbc.validationQuery}" />
        <property name="maxActive" value="${application.tests.jdbc.maxActive}" />
        <property name="maxIdle" value="${application.tests.jdbc.maxIdle}" />
        <property name="maxWait" value="${application.tests.jdbc.maxWait}" />
        <property name="username" value="${application.tests.jdbc.username}" />
        <property name="password" value="${application.tests.jdbc.password}" />
        <property name="driverClassName" value="${application.tests.jdbc.driverClassName}" />
        <property name="url" value="${application.tests.jdbc.url}" />
    </bean>

    <alias name="persistence.EntityManagerFactory" alias="entityManagerFactory"/>

    <bean id="hibernateStatisticsMBean" class="org.hibernate.jmx.StatisticsService">
        <property name="statisticsEnabled" value="true" />
        <property name="sessionFactory" value="#{entityManagerFactory.sessionFactory}" />
    </bean>

    <bean id="jmxExporter" class="org.springframework.jmx.export.MBeanExporter">
        <property name="registrationPolicy" value="IGNORE_EXISTING" />
        <property name="beans">
            <map>
                <entry key="Hibernate:type=statistics">
                    <ref local="hibernateStatisticsMBean" />
                </entry>
            </map>
        </property>
    </bean>

</beans>
