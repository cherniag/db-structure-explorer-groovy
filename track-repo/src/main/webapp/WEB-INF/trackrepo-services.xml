<?xml version="1.0" encoding="UTF-8"?>
<beans default-lazy-init="true" default-init-method="init"
       xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="trackRepo.cloudHttpClient" class="org.apache.http.impl.client.DefaultHttpClient"/>

    <bean id="trackRepo.CloudFileService" class="mobi.nowtechnologies.server.service.impl.CloudFileServiceImpl" init-method="init">
		<property name="userName" value="${cloudFile.userName}" />
		<property name="password" value="${cloudFile.password}" />
		<property name="account" value="${cloudFile.account}" />
		<property name="connectionTimeOutMilliseconds" value="${cloudFile.connectionTimeOutMilliseconds}" />
		<property name="authenticationURL" value="${cloudFile.authenticationURL}" />
		<property name="useETag" value="${cloudFile.useETag}" />
		<property name="userAgent" value="${cloudFile.userAgent}" />
		<property name="containerName" value="${cloudFile.containerName}" />
		<property name="filesURL" value="${cloudFile.filesURL}" />
        <property name="httpClient" ref="trackRepo.cloudHttpClient"/>
		<property name="copyFileOnCloudAttemptCount" value="${cloudFile.copyFileOnCloudAttemptCount}"/>
	</bean>

    <bean id="trackRepo.TrackService" class="mobi.nowtechnologies.server.trackrepo.service.impl.TrackServiceImpl">
        <property name="itunesScript" value="${trackRepo.itunes.script}" />
		<property name="trackRepository" ref="trackRepository" />
		<property name="cloudFileService" ref="trackRepo.CloudFileService" />		
		<property name="srcPullContainer" value="${trackRepo.pull.cdn.container.src}" />
		<property name="destPullContainer" value="${trackRepo.pull.cdn.container.dest}" />
		<property name="brightcoveWriteToken" value="${brightcove.token.write}" />
		<property name="brightcoveReadToken" value="${brightcove.token.read}" />
		<property name="brightcoveGeoFiltering" value="${brightcove.geo.filter}" />
		<property name="sevenDigitalApiUrl" value="${trackrepo.7digital.url}" />
		<property name="sevenDigitalApiKey" value="${trackrepo.7digital.key}" />
		<property name="restTemplate" ref="service.RestTemplate" />
		<property name="encodeManager" ref="service.encode.manager"/>
	</bean>

    <bean id="trackRepo.ParserFactory" class="mobi.nowtechnologies.server.trackrepo.ingest.IParserFactory">
        <property name="sonyRoot" value="${trackRepo.ingest.sony.root}" />
        <property name="sonyDDEXRoot" value="${trackRepo.ingest.sony.ddex.root}" />
        <property name="warnerOldRoot" value="${trackRepo.ingest.warner.root}" />
        <property name="warnerRoot" value="${trackRepo.ingest.warnerV34.root}" />
        <property name="universalRoot" value="${trackRepo.ingest.universal.root}" />
        <property name="fugaRoot" value="${trackRepo.ingest.fuga.root}" />
        <property name="ciRoot" value="${trackRepo.ingest.ci.root}" />
        <property name="emiRoot" value="${trackRepo.ingest.emi.root}" />
        <property name="emiUmgRoot" value="${trackRepo.ingest.emi_umg.root}" />
        <property name="iodaRoot" value="${trackRepo.ingest.ioda.root}" />
        <property name="manualRoot" value="${trackRepo.ingest.manual.root}" />
        <property name="mosRoot" value="${trackRepo.ingest.mos.root}" />
        <property name="universalDDEX_V3_7_AssetAndMetaData_V1_13_Root" value="${trackRepo.ingest.universal.ddex.3.7.asset.and.meta.data.1.13.root}"/>
	</bean>

    <bean id="trackRepo.IngestService" class="mobi.nowtechnologies.server.trackrepo.service.impl.IngestServiceImpl" destroy-method="destroy">
		<property name="trackRepository" ref="trackRepository" />
		<property name="ingestionLogRepository" ref="ingestionLogRepository" />
		<property name="parserFactory" ref="trackRepo.ParserFactory" />
		<property name="executorService">
			<bean class="java.util.concurrent.Executors" factory-method="newFixedThreadPool">
				<constructor-arg value="#{T(mobi.nowtechnologies.server.trackrepo.ingest.Ingestor).values().length}" />
			</bean>
		</property>
	</bean>

    <bean name="trackRepo.ResourceFileDtoBuilder" class="mobi.nowtechnologies.server.trackrepo.dto.builder.ResourceFileDtoBuilder" init-method="init">
		<property name="publishDir" value="${trackRepo.pull.publish}" />
    </bean>
	
	<bean id="trackRepo.FileService" class="mobi.nowtechnologies.server.trackrepo.service.impl.FileServiceImpl">
		<property name="fileRepository" ref="fileRepository" />
	</bean>
	
	<bean id="service.RestTemplate"  class="org.springframework.web.client.RestTemplate" />
	
	<bean id="service.encode.imageGenerator" class="mobi.nowtechnologies.server.trackrepo.utils.image.ShellImageGeneratorImpl">
		<property name="commandResizeImage" ref="service.encode.resizeImage"/>
		<property name="commandCoverPreviewImage" ref="service.encode.coverPreviewImage"/>
		<property name="convertPath" value="${trackrepo.encode.convertPath}"/>
		<property name="compositePath" value="${trackrepo.encode.compositePath}"/>
		<property name="thumbnails">
			<list>
				<bean class="mobi.nowtechnologies.server.trackrepo.utils.image.ThumbnailType">
					<property name="fileNameTail" value="S"/>
					<property name="imageSize" value="70"/>
					<property name="coverFilePath" value="/WEB-INF/bin/images/coming-soon-70.png"/>
                    <property name="additionalParams" value="${coming-soon.additionalParams}"/>
				</bean>
				<bean class="mobi.nowtechnologies.server.trackrepo.utils.image.ThumbnailType">
					<property name="fileNameTail" value="_22"/>
					<property name="imageSizeForAudio" value="350"/>
					<property name="imageSizeForVideo" value="640"/>
					<property name="coverFilePath" value="/WEB-INF/bin/images/coming-soon-200.png"/>
                    <property name="additionalParams" value="${coming-soon.additionalParams}"/>
				</bean>
				<bean class="mobi.nowtechnologies.server.trackrepo.utils.image.ThumbnailType">
					<property name="fileNameTail" value="_21"/>
					<property name="imageSize" value="90"/>
					<property name="coverFilePath" value="/WEB-INF/bin/images/coming-soon-90.png"/>
                    <property name="additionalParams" value="${coming-soon.additionalParams}"/>
				</bean>
				<bean class="mobi.nowtechnologies.server.trackrepo.utils.image.ThumbnailType">
					<property name="fileNameTail" value="_3"/>
					<property name="imageSize" value="240"/>
					<property name="coverFilePath" value="/WEB-INF/bin/images/coming-soon-240.png"/>
                    <property name="additionalParams" value="${coming-soon.additionalParams}"/>
				</bean>
				<bean class="mobi.nowtechnologies.server.trackrepo.utils.image.ThumbnailType">
					<property name="fileNameTail" value="_6"/>
					<property name="imageSize" value="60"/>
					<property name="coverFilePath" value="/WEB-INF/bin/images/coming-soon-60.png"/>
                    <property name="additionalParams" value="${coming-soon.additionalParams}"/>
				</bean>
				<bean class="mobi.nowtechnologies.server.trackrepo.utils.image.ThumbnailType">
					<property name="fileNameTail" value="_cover"/>
					<property name="imageSize" value="150"/>
					<property name="fileExtension" value="png"/>
					<property name="additionalParams" value="-depth 8 -quality 00"/>
				</bean>
			</list>
		</property>
	</bean>
	
	<bean id="service.encode.manager" class="mobi.nowtechnologies.server.trackrepo.utils.EncodeManager">
		<property name="commandGetEncoding" ref="service.encode.getEncoding"/>
		<property name="commandEncodeUnknown" ref="service.encode.encodeUnknown"/>
		<property name="commandEncodeMP3" ref="service.encode.encodeMP3"/>
		<property name="commandEncodeACC" ref="service.encode.encodeACC"/>
		<property name="commandEncodeWAV" ref="service.encode.encodeWAV"/>
		<property name="commandDecodeMP3" ref="service.encode.decodeMP3"/>
		<property name="commandEncodeMobileAudio" ref="service.encode.encodeMobileAudio"/>
		<property name="commandEncodePreviewAudio" ref="service.encode.encodePreviewAudio"/>
		<property name="commandAddTag" ref="service.encode.addTag"/>
		<property name="imageGenerator" ref="service.encode.imageGenerator"/>
		<property name="commandUITS" ref="service.encode.uitsAdapter"/>
		<property name="workDir" value="${trackRepo.encode.workdir}/"/>
		<property name="neroHome" value="${trackRepo.encode.nero.home}"/>
		<property name="cloudUploadFileManager" ref="service.encode.cloudUploadFileManager"/>
	</bean>
	
	<bean id="service.encode.getEncoding" class="mobi.nowtechnologies.server.trackrepo.utils.ExternalCommand">
		<property name="command" value="${trackrepo.encode.scriptDir}/get_encoding.${scriptsExtension}"/>
	</bean>
	<bean id="service.encode.encodeUnknown" class="mobi.nowtechnologies.server.trackrepo.utils.ExternalCommand">
		<property name="command" value="${trackrepo.encode.scriptDir}/encode_unknown.${scriptsExtension}"/>
	</bean>
	<bean id="service.encode.encodeMP3" class="mobi.nowtechnologies.server.trackrepo.utils.ExternalCommand">
		<property name="command" value="${trackrepo.encode.scriptDir}/encode_mp3.${scriptsExtension}"/>
	</bean>
	<bean id="service.encode.encodeACC" class="mobi.nowtechnologies.server.trackrepo.utils.ExternalCommand">
		<property name="command" value="${trackrepo.encode.scriptDir}/encode_acc.${scriptsExtension}"/>
	</bean>
	<bean id="service.encode.encodeWAV" class="mobi.nowtechnologies.server.trackrepo.utils.ExternalCommand">
		<property name="command" value="${trackrepo.encode.scriptDir}/encode_wav.${scriptsExtension}"/>
	</bean>
	<bean id="service.encode.decodeMP3" class="mobi.nowtechnologies.server.trackrepo.utils.ExternalCommand">
		<property name="command" value="${trackrepo.encode.scriptDir}/decode_mp3.${scriptsExtension}"/>
	</bean>
	<bean id="service.encode.encodeMobileAudio" class="mobi.nowtechnologies.server.trackrepo.utils.ExternalCommand">
		<property name="command" value="${trackrepo.encode.scriptDir}/encode_mobile_audio.${scriptsExtension}"/>
	</bean>
	<bean id="service.encode.addTag" class="mobi.nowtechnologies.server.trackrepo.utils.ExternalCommand">
		<property name="command" value="${trackrepo.encode.scriptDir}/add_tag.${scriptsExtension}"/>
	</bean>
	<bean id="service.encode.encodePreviewAudio" class="mobi.nowtechnologies.server.trackrepo.utils.ExternalCommand">
		<property name="command" value="${trackrepo.encode.scriptDir}/encode_preview_audio.${scriptsExtension}"/>
	</bean>
	<bean id="service.encode.resizeImage" class="mobi.nowtechnologies.server.trackrepo.utils.ExternalCommand">
		<property name="command" value="${trackrepo.encode.scriptDir}/resize_image.${scriptsExtension}"/>
	</bean>
	<bean id="service.encode.coverPreviewImage" class="mobi.nowtechnologies.server.trackrepo.utils.ExternalCommand">
		<property name="command" value="${trackrepo.encode.scriptDir}/cover_preview_image.${scriptsExtension}"/>
	</bean>
	
	<bean id="service.encode.uitsAdapter" class="mobi.nowtechnologies.server.trackrepo.utils.UITSCommandAdapter">
        <property name="uits" ref="uits"/>
	</bean>

    <bean id="uits" class="mobi.nowtechnologies.server.trackrepo.uits.UITS">
        <property name="mp4Manager" ref="mp4Manager"/>
		<property name="mp3Manager" ref="mp3Manager"/>
		<property name="privateKey" value="${trackRepo.encode.privkey}"/>
    </bean>

    <bean id="mp4Manager" class="mobi.nowtechnologies.server.trackrepo.uits.MP4Manager"/>

    <bean id="mp3Manager" class="mobi.nowtechnologies.server.trackrepo.uits.MP3Manager"/>

	<bean id="service.encode.cloudUploadFileManager" class="mobi.nowtechnologies.server.trackrepo.utils.UploadToCloudFileManager">
		<property name="dataContainerName" value="${trackRepo.pull.cdn.container.dest}"/>
		<property name="privateContainerName" value="${trackRepo.pull.cdn.container.src}"/>
		<property name="cloudService" ref="trackRepo.CloudFileService"/>
		<property name="fileExtensionToContentTypeMap">
			<map>
				<entry key="mp3" value="audio/mpeg"/>
				<entry key="m4a" value="audio/x-m4a"/>
				<entry key="jpg" value="image/jpeg"/>
				<entry key="png" value="image/png"/>
			</map>
		</property>
		<property name="defaultContentType" value="application/octet-stream"/>
	</bean>

	<bean id="trackReportingOptionsService" class="mobi.nowtechnologies.server.trackrepo.service.impl.TrackReportingOptionsService">
		<property name="trackRepository" ref="trackRepository"/>
	</bean>

</beans>