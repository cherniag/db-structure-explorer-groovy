<?xml version="1.0" encoding="UTF-8"?>
<beans default-init-method="init" xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:task="http://www.springframework.org/schema/task"
       xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
http://www.springframework.org/schema/task
http://www.springframework.org/schema/task/spring-task-3.1.xsd
http://www.springframework.org/schema/aop
http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
http://www.springframework.org/schema/util
http://www.springframework.org/schema/util/spring-util-3.1.xsd">

    <import resource="task.xml"/>

    <import resource="classpath:META-INF\service-details-extractors.xml"/>

    <import resource="classpath:META-INF\service-chart-supporter.xml"/>

	<!-- Application properties -->
    <import resource="placeholders.xml"/>
    <import resource="streamzine-service.xml"/>
    <import resource="classpath:META-INF/smpp.xml"/>

	<bean class="org.springframework.beans.factory.config.CustomEditorConfigurer">
		<property name="customEditors">
			<map>
				<entry key="com.jayway.jsonpath.JsonPath" value="mobi.nowtechnologies.server.utils.JsonPathPropertyEditor"/>
			</map>
		</property>
	</bean>

	<bean id="service.DeviceUserDataService" class="mobi.nowtechnologies.server.service.DeviceUserDataService">
		<property name="deviceUserDataRepository" ref="deviceUserDataRepository" />
	</bean>

    <bean id="service.AppsFlyerDataService" class="mobi.nowtechnologies.server.service.AppsFlyerDataService"/>

	<bean id="service.VersionService" class="mobi.nowtechnologies.server.service.VersionService">
		<property name="manifest" value="META-INF/MANIFEST.MF" />
	</bean>

	<bean id="userStatusTypeService" class="mobi.nowtechnologies.server.service.behavior.UserStatusTypeService" />
    <bean id="behaviorInfoService" class="mobi.nowtechnologies.server.service.behavior.BehaviorInfoService">
		<property name="activationDatePropertyName" value="referral.logic.activation.date" />
    </bean>
	<bean class="mobi.nowtechnologies.server.service.behavior.ChartBehaviorService" />
	<bean class="mobi.nowtechnologies.server.service.behavior.ChartBehaviorReferralsService" />
	<bean class="mobi.nowtechnologies.server.service.behavior.ChartBehaviorReferralsRulesService" />

    <bean id="timeService" class="mobi.nowtechnologies.server.TimeService"/>

    <bean id="service.EntityService" class="mobi.nowtechnologies.server.service.EntityService">
		<property name="entityDao" ref="persistence.EntityDao" />
	</bean>
	
	<bean id="service.UserServiceNotification" class="mobi.nowtechnologies.server.service.UserServiceNotification"/>

    <bean id="service.O2UserDetailsUpdater" class="mobi.nowtechnologies.server.service.o2.impl.O2UserDetailsUpdater">
        <property name="userService" ref="service.UserService" />
    </bean>

    <bean id="accountCheckDTOAsm" class="mobi.nowtechnologies.server.assembler.AccountCheckDTOAsm">
        <property name="autoOptInExemptPhoneNumberRepository" ref="autoOptInExemptPhoneNumberRepository" />
        <property name="autoOptInRuleService" ref="service.AutoOptInRuleService"/>
        <property name="userDetailsDtoAsm" ref="userDetailsDtoAsm"/>
		<property name="iTunesPaymentService" ref="service.iTunesPaymentService"/>
    </bean>

    <bean id="userDetailsDtoAsm" class="mobi.nowtechnologies.server.assembler.UserDetailsDtoAsm"/>

    <bean name="deepLinkInfoService" class="mobi.nowtechnologies.server.assembler.streamzine.DeepLinkInfoService">
        <property name="mediaRepository" ref="mediaRepository" />
        <property name="messageRepository" ref="messageRepository"/>
    </bean>

	<bean name="deepLinkUrlFactory" class="mobi.nowtechnologies.server.assembler.streamzine.DeepLinkUrlFactory">
        <property name="deepLinkInfoService" ref="deepLinkInfoService" />
	</bean>

    <bean name="cloudFileImagesService" class="mobi.nowtechnologies.server.service.streamzine.CloudFileImagesService">
        <property name="cloudFileService" ref="service.CloudFileService" />
        <property name="imageService" ref="imageService" />
    </bean>

    <bean name="badgesService" class="mobi.nowtechnologies.server.service.streamzine.BadgesService">
        <property name="filenameAliasRepository" ref="filenameAliasRepository" />
        <property name="cloudFileImagesService" ref="cloudFileImagesService" />
        <property name="resolutionRepository" ref="resolutionRepository" />
        <property name="badgeMappingRepository" ref="badgeMappingRepository" />
        <property name="cloudFileService" ref="service.CloudFileService" />
        <property name="imageService" ref="imageService" />
    </bean>

    <bean name="streamzineUpdateAsm" class="mobi.nowtechnologies.server.assembler.StreamzineUpdateAsm">
        <property name="deepLinkUrlFactory" ref="deepLinkUrlFactory" />
        <property name="deepLinkInfoService" ref="deepLinkInfoService" />
        <property name="badgeMappingRepository" ref="badgeMappingRepository" />
        <property name="communityRepository" ref="communityRepository" />
        <property name="resolutionRepository" ref="resolutionRepository" />
        <property name="badgesService" ref="badgesService" />
    </bean>

    <bean name="streamzineUpdateService" class="mobi.nowtechnologies.server.service.streamzine.StreamzineUpdateService">
        <property name="streamzineUpdateRepository" ref="streamzineUpdateRepository" />
        <property name="availableCommunites" value="${streamzine.available.communities}" />
        <property name="communityRepository" ref="communityRepository" />
    </bean>

	<bean id="service.UserService" class="mobi.nowtechnologies.server.service.UserService">
		<property name="entityService" ref="service.EntityService" />
		<property name="countryAppVersionService" ref="service.CountryAppVersionService" />
		<property name="userDao" ref="persistence.UserDao" />
		<property name="countryService" ref="service.CountryService" />
		<property name="promotionService" ref="service.PromotionService" />
		<property name="paymentDetailsService" ref="service.PaymentDetailsService" />
		<property name="migHttpService" ref="service.migHttpService" />
		<property name="messageSource" ref="serviceMessageSource" />
		<property name="countryByIpService" ref="service.CountryByIpService" />
		<property name="userDeviceDetailsService" ref="service.UserDeviceDetailsService" />
		<property name="communityService" ref="service.communityService" />
		<property name="mailService" ref="service.MailService" />
		<property name="deviceService" ref="service.DeviceService" />
		<property name="accountLogService" ref="service.AccountLogService" />
		<property name="userRepository" ref="userRepository" />
		<property name="o2ClientService" ref="service.O2ClientService" />
        <property name="refundService" ref="service.RefundService" />
        <property name="userServiceNotification" ref="service.UserServiceNotification"/>
        <property name="o2UserDetailsUpdater" ref="service.O2UserDetailsUpdater" />

        <property name="mobileProviderService" ref="service.O2ClientService" />
        <property name="userDetailsUpdater" ref="service.O2UserDetailsUpdater" />
        <property name="otacValidationService" ref="service.OtacValidationService" />
        <property name="userGroupRepository" ref="userGroupRepository" />
        <property name="userNotificationService" ref="service.UserNotificationService" />
        <property name="taskService" ref="task.TaskService"/>
        <property name="sendActivationSMS" value="false"/>
        <property name="autoOptInRuleService" ref="service.AutoOptInRuleService"/>
        <property name="reactivationUserInfoRepository" ref="reactivationUserInfoRepository"/>
        <property name="deviceUserDataService" ref="service.DeviceUserDataService"/>
        <property name="appsFlyerDataService" ref="service.AppsFlyerDataService"/>
	</bean>

    <bean id="vf_nz.service.UserService" class="mobi.nowtechnologies.server.service.UserService" parent="service.UserService">
        <property name="mobileProviderService" ref="vf_nz.service.MobileProviderService" />
        <property name="userDetailsUpdater" ref="vf_nz.service.UserDetailsUpdater" />
        <property name="sendActivationSMS" value="true"/>
    </bean>

    <bean id="vf_nz.service.SubsriberDataParser" class="mobi.nowtechnologies.server.service.vodafone.impl.VFNZSubscriberDataParser"/>

    <bean id="vf_nz.service.MobileProviderService" class="mobi.nowtechnologies.server.service.vodafone.impl.VFNZProviderServiceImpl">
        <property name="gatewayService" ref="vf_nz.service.VFNZSMSGatewayService" />
        <property name="providerNumber" value="${vf.nz.smpp.service.source.address.provider}" />
        <property name="deviceService" ref="service.DeviceService" />
    </bean>

    <bean id="vf_nz.service.VFNZUnsubscribeProccessor" class="mobi.nowtechnologies.server.service.vodafone.impl.VFNZUnsubscribeProccessor">
        <property name="supportedNumbers">
            <set>
                <value>${vf.nz.smpp.service.source.address.unsubscribe}</value>
                <value>${vf.nz.smpp.service.source.address.unsubscribe.for.mtvnz}</value>
                <value>${vf.nz.smpp.service.source.address.billing.6gbp}</value>
                <value>${vf.nz.smpp.service.source.address.billing.1_5gbp}</value>
            </set>
        </property>
        <property name="userService" ref="vf_nz.service.UserService" />
    </bean>

    <bean id="vf_nz.service.UserDetailsUpdater" class="mobi.nowtechnologies.server.service.vodafone.impl.VFNZUserDetailsUpdater">
        <property name="providerNumber" value="${vf.nz.smpp.service.source.address.provider}" />
        <property name="userService" ref="vf_nz.service.UserService" />
        <property name="messageParser" ref="vf_nz.service.SubsriberDataParser" />
    </bean>

	<bean id="service.PaymentDetailsService" class="mobi.nowtechnologies.server.service.PaymentDetailsService">
        <property name="paymentPolicyRepository" ref="paymentPolicyRepository"/>
        <property name="paymentPolicyDao" ref="persistence.PaymentPolicyDao"/>
		<property name="paymentDetailsDao" ref="persistence.PaymentDetailsDao" />
		<property name="paymentPolicyService" ref="service.PaymentPolicyService" />
		<property name="sagePayPaymentService" ref="service.sagePayPaymentService" />
		<property name="payPalPaymentService" ref="service.payPalPaymentService" />
		<property name="migPaymentService" ref="service.migPaymentService" />
		<property name="o2PaymentService" ref="service.o2PaymentService" />
		<property name="promotionService" ref="service.PromotionService" />

		<property name="messageSource" ref="serviceMessageSource" />

		<property name="communityService" ref="service.communityService" />
		<property name="offerService" ref="service.OfferService" />
		<property name="userService" ref="service.UserService" />
		<property name="paymentDetailsRepository" ref="paymentDetailsRepository" />
		
		<property name="userRepository" ref="userRepository" />
	</bean>

	<bean id="service.DeviceService" class="mobi.nowtechnologies.server.service.DeviceService">
		<property name="notPromotedDeviceRepository" ref="notPromotedDeviceRepository" />
		<property name="promotedDeviceRepository" ref="promotedDeviceRepository" />
		<property name="messageSource" ref="serviceMessageSource" />
	</bean>

	<bean id="service.DeviceTypeService" class="mobi.nowtechnologies.server.service.DeviceTypeService">
	</bean>

	<bean id="service.DrmService" class="mobi.nowtechnologies.server.service.DrmService">
		<property name="drmDao" ref="persistence.DrmDao" />
		<property name="entityService" ref="service.EntityService" />
		<property name="mediaService" ref="service.MediaService" />
		<property name="drmRepository" ref="drmRepository" />
	</bean>

	<bean id="service.AccountLogService" class="mobi.nowtechnologies.server.service.AccountLogService">
		<property name="accountLogDao" ref="persistence.AccountLogDao" />
		<property name="accountLogRepository" ref="accountLogRepository" />
	</bean>

	<bean id="service.MediaLogService" class="mobi.nowtechnologies.server.service.MediaLogService">
		<property name="mediaLogDao" ref="persistence.MediaLogDao" />
	</bean>

	<bean id="service.MediaLogTypeService" class="mobi.nowtechnologies.server.service.MediaLogTypeService">
		<property name="mediaLogTypeDao" ref="persistence.MediaLogTypeDao" />
	</bean>

	<bean id="service.PromotionService" class="mobi.nowtechnologies.server.service.PromotionService" >
		<property name="entityService" ref="service.EntityService" />
		<property name="promotionDao" ref="persistence.PromotionDao" />
        <property name="promotionRepository" ref="promotionRepository" />
        <property name="userService" ref="service.UserService" />
        <property name="messageSource" ref="serviceMessageSource" />
        <property name="userBannedRepository" ref="userBannedRepository" />
        <property name="deviceService" ref="service.DeviceService" />
        <property name="communityService" ref="service.communityService"/>
        <property name="configuration" ref="configuration.PromotionService"/>
    </bean>

    <bean id="configuration.PromotionService" class="mobi.nowtechnologies.server.service.PromotionConfiguration">
        <property name="subscriptionCampaignRepository" ref="subscriptionCampaignRepository"/>
        <property name="promotionProvider" ref="provider.Promotion"/>
    </bean>

    <bean id="provider.Promotion" class="mobi.nowtechnologies.server.service.PromotionProvider">
        <property name="entityService" ref="service.EntityService" />
        <property name="promotionRepository" ref="promotionRepository" />
        <property name="messageSource" ref="serviceMessageSource" />
        <property name="communityService" ref="service.communityService"/>
    </bean>

    <bean id="service.ChartDetailsConverter" class="mobi.nowtechnologies.server.service.chart.ChartDetailsConverter">
        <property name="messageSource" ref="serviceMessageSource"/>
        <property name="iTunesLinkFormatCutoverTimeMillis" value="${transport.itunes.affiliate.link.format.cutover.time.millis}"/>
		<property name="badgesService" ref="badgesService"/>
    </bean>

	<bean id="service.ChartService" class="mobi.nowtechnologies.server.service.ChartService">
		<property name="chartDetailService" ref="service.ChartDetailService" />
		<property name="userService" ref="service.UserService" />
		<property name="drmService" ref="service.DrmService" />
		<property name="chartRepository" ref="chartRepository" />
		<property name="chartDetailRepository" ref="chartDetailRepository" />
		<property name="messageSource" ref="serviceMessageSource" />
		<property name="cloudFileService" ref="service.CloudFileService" />
        <property name="chartDetailsConverter" ref="service.ChartDetailsConverter"/>
    </bean>

	<bean id="service.ChartDetailService" class="mobi.nowtechnologies.server.service.ChartDetailService">
		<property name="chartDetailRepository" ref="chartDetailRepository" />
		<property name="mediaService" ref="service.MediaService" />
        <property name="mediaRepository" ref="mediaRepository"/>
	</bean>

	<bean id="service.MailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
		<property name="host" value="${mail.host}" />
		<property name="port" value="${mail.port}" />
		<property name="username" value="${mail.username}" />
		<property name="password" value="${mail.password}" />
		<property name="javaMailProperties">
			<props>
				<prop key="mail.smtp.auth">${mail.auth}</prop>
				<prop key="mail.debug">${mail.debug}</prop>
				<prop key="mail.transport.protocol">${mail.protocol}</prop>
				<prop key="mail.smtp.from">${mail.from}</prop>
			</props>
		</property>
	</bean>

	<bean id="service.MediaService" class="mobi.nowtechnologies.server.service.MediaService">
		<property name="entityService" ref="service.EntityService" />
		<property name="mediaDao" ref="persistence.MediaDao" />
		<property name="mediaLogTypeService" ref="service.MediaLogTypeService" />
		<property name="mediaLogService" ref="service.MediaLogService" />
		<property name="mediaRepository" ref="mediaRepository" />
		<property name="chartRepository" ref="chartRepository" />
		<property name="chartDetailRepository" ref="chartDetailRepository" />
	</bean>

	<bean id="service.FileService" class="mobi.nowtechnologies.server.service.FileService">
		<property name="userService" ref="service.UserService" />
		<property name="mediaService" ref="service.MediaService" />
        <property name="mediaRepository" ref="mediaRepository" />
		<property name="storePath" value="${store.path}" />
		<property name="brightcoveReadToken" value="${brightcove.token.read}" />
        <property name="cloudFileService" ref="service.CloudFileService"/>
        <property name="destinationContainerNameForAudioContent" value="${cloudFile.audioContentContainerName}"/>
	</bean>

	<bean id="service.CountryAppVersionService" class="mobi.nowtechnologies.server.service.CountryAppVersionService">
		<property name="countryAppVersionDao" ref="persistence.CountryAppVersionDao" />
	</bean>

	<bean id="service.CountryService" class="mobi.nowtechnologies.server.service.CountryService">
		<property name="entityDao" ref="persistence.EntityDao" />
	</bean>

	<bean id="service.PaymentPolicyService" class="mobi.nowtechnologies.server.service.PaymentPolicyService">
		<property name="paymentPolicyDao" ref="persistence.PaymentPolicyDao" />
		<property name="paymentPolicyRepository" ref="paymentPolicyRepository" />
	</bean>

	<bean id="service.PaymentService" class="mobi.nowtechnologies.server.service.PaymentService">
		<property name="paymentDao" ref="persistence.PaymentDao" />
	</bean>

    <bean id="service.O2Service" class="mobi.nowtechnologies.server.service.o2.impl.O2ServiceImpl">
        <property name="O2TariffService" ref="service.O2TariffService"/>
        <property name="restTemplate" ref="service.RestTemplate" />
    </bean>

    <bean id="serviceReloadableResourceBundleMessageSource"
          class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
        <property name="basenames">
            <list>
                <value>file:#{systemProperties['catalina.base']}/conf/services</value>
                <value>classpath:services</value>
            </list>
        </property>
        <property name="defaultEncoding" value="utf-8" />
        <property name="fileEncodings" value="utf-8" />
        <property name="cacheSeconds" value="180" />
        <property name="useCodeAsDefaultMessage" value="true" />
    </bean>

    <bean id="serviceMessageSource"
          class="mobi.nowtechnologies.server.shared.message.CommunityResourceBundleMessageSourceImpl">
        <property name="reloadableResourceBundleMessageSource" ref="serviceReloadableResourceBundleMessageSource"/>
        <property name="stringEncryptor" ref="configurationEncryptor"/>
    </bean>

	<import resource="social.xml" />

	<bean id="service.WeeklyUpdateService" class="mobi.nowtechnologies.server.service.WeeklyUpdateService">
		<property name="userService" ref="service.UserService" />
	</bean>

	<bean id="service.UserDeviceDetailsService" class="mobi.nowtechnologies.server.service.UserDeviceDetailsService">
		<property name="entityService" ref="service.EntityService" />
		<property name="userIPhoneDetailsService" ref="service.UserIPhoneDetailsService" />
		<property name="userAndroidDetailsService" ref="service.UserAndroidDetailsService" />
	</bean>

	<bean id="service.UserIPhoneDetailsService" class="mobi.nowtechnologies.server.service.UserIPhoneDetailsService" parent="service.UserDeviceDetailsService">
		<property name="userIPhoneDetailsRepository" ref="userIPhoneDetailsRepository" />
		<property name="userIPhoneDetailsDao" ref="persistence.UserIPhoneDetailsDao" />
	</bean>


	<bean id="service.UserAndroidDetailsService" class="mobi.nowtechnologies.server.service.UserAndroidDetailsService" parent="service.UserDeviceDetailsService">
		<property name="userAndroidDetailsDao" ref="persistence.UserAndroidDetailsDao" />
	</bean>

	<bean id="service.CountryByIpService" class="mobi.nowtechnologies.server.service.CountryByIpService">
		<property name="storePath" value="${store.path}" />
	</bean>

	<!-- AOP Services -->
	<aop:aspectj-autoproxy proxy-target-class="true" expose-proxy="true"/>

	<bean id="mailNotificationAspect" class="mobi.nowtechnologies.server.service.aop.MailNotification">
		<property name="mailService" ref="service.MailService" />
		<property name="userService" ref="service.UserService" />
		<property name="messageSource" ref="serviceMessageSource" />
	</bean>

	<bean id="smsNotificationAspect" class="mobi.nowtechnologies.server.service.aop.SMSNotification" depends-on="service.WeeklyUpdateService">
		<property name="userService" ref="service.UserService" />
		<property name="userNotificationService" ref="service.UserNotificationService" />
	</bean>
	
	<bean id="service.profileLoggingAspect" class="mobi.nowtechnologies.server.service.aop.ProfileLoggingAspect">
		<property name="communityResourceBundleMessageSource" ref="serviceMessageSource" />
	</bean>

	<bean id="service.communityService" class="mobi.nowtechnologies.server.service.impl.CommunityServiceImpl">
		<property name="communityRepository" ref="communityRepository" />
	</bean>

	<bean id="service.userDetailsServiceWrapper" class="org.springframework.security.access.hierarchicalroles.UserDetailsServiceWrapper"></bean>

	<bean id="service.CloudFileService" class="mobi.nowtechnologies.server.service.impl.CloudFileServiceImpl" init-method="init">
		<property name="userName" value="${cloudFile.userName}" />
		<property name="password" value="${cloudFile.password}" />
		<property name="account" value="${cloudFile.account}" />
		<property name="connectionTimeOutMilliseconds" value="${cloudFile.connectionTimeOutMilliseconds}" />
		<property name="authenticationURL" value="${cloudFile.authenticationURL}" />
		<property name="useETag" value="${cloudFile.useETag}" />
		<property name="userAgent" value="${cloudFile.userAgent}" />
		<property name="containerName" value="${cloudFile.containerName}" />
		<property name="filesURL" value="${cloudFile.filesURL}" />
        <property name="httpClient" ref="service.cloudHttpClient"/>
		<property name="copyFileOnCloudAttemptCount" value="${cloudFile.copyFileOnCloudAttemptCount}"/>
	</bean>

    <bean id="service.cloudHttpConnectionManager" class="org.apache.http.impl.conn.PoolingClientConnectionManager">
        <property name="maxTotal" value="${cloudFile.getFileThreadPoolCount}" />
        <property name="defaultMaxPerRoute" value="${cloudFile.getFileThreadPoolCount}" />
    </bean>

    <bean id="service.cloudHttpClient" class="org.apache.http.impl.client.DefaultHttpClient">
       <constructor-arg index="0" ref="service.cloudHttpConnectionManager"/>
       <constructor-arg index="1"><null/></constructor-arg>
    </bean>


	<bean id="service.MessageService" class="mobi.nowtechnologies.server.service.MessageService">
		<property name="userService" ref="service.UserService" />
		<property name="filterService" ref="service.FilterService" />
		<property name="communityService" ref="service.communityService" />
		<property name="messageRepository" ref="messageRepository" />
		<property name="cloudFileService" ref="service.CloudFileService" />
	</bean>

	<bean id="service.OfferService" class="mobi.nowtechnologies.server.service.OfferService">
		<property name="filterService" ref="service.FilterService" />
		<property name="offerRepository" ref="offerRepository" />
		<property name="itemRepository" ref="itemRepository" />
		<property name="userService" ref="service.UserService" />
		<property name="accountLogService" ref="service.AccountLogService" />
		<property name="cloudFileService" ref="service.CloudFileService" />
	</bean>

	<bean id="trackRepoClient" class="mobi.nowtechnologies.server.trackrepo.TrackRepositoryHttpClientImpl">
		<property name="trackRepoUrl" value="${trackRepo.baseURL}" />
		<property name="numQuerySchedulerThreads" value="${trackRepo.executor.maxPoolSize}" />
	</bean>

	<bean id="service.TrackRepoService" class="mobi.nowtechnologies.server.service.impl.TrackRepoServiceImpl">
		<property name="mediaRepository" ref="mediaRepository" />
		<property name="mediaFileRepository" ref="mediaFileRepository" />
		<property name="genreRepository" ref="genreRepository" />
		<property name="artistRepository" ref="artistRepository" />
        <property name="labelRepository" ref="labelRepository" />
		<property name="client" ref="trackRepoClient" />
        <property name="iTunesLinkFormatCutoverTimeMillis" value="${trackRepo.itunes.affiliate.link.format.cutover.time.millis}"/>
    </bean>

	<bean id="service.FilterService" class="mobi.nowtechnologies.server.service.FilterService">
		<property name="filterWithCriteriaRepository" ref="filterWithCriteriaRepository" />
	</bean>

    <bean name="smsServiceFacade" class="mobi.nowtechnologies.server.service.impl.SmsServiceFacade">
        <property name="messageSource" ref="serviceMessageSource" />
    </bean>

	<bean id="service.UserNotificationService" class="mobi.nowtechnologies.server.service.impl.UserNotificationServiceImpl">
		<property name="userService" ref="service.UserService" />
		<property name="smsServiceFacade" ref="smsServiceFacade" />
		<property name="messageSource" ref="serviceMessageSource" />
		<property name="paymentsUrl" value="${payments.url}" />
		<property name="unsubscribeUrl" value="${unsubscribe.url}" />
		<property name="tinyUrlService" value="${tinyurl.service}" />
		<property name="availableCommunities" value="${sms.available.communities}" />
		<property name="rememberMeServices" ref="nowTechBasedRememberMeServices"/>
		<property name="rememberMeTokenCookieName" value="${rememberMe.cookieName}"/>
		<property name="deviceService" ref="service.DeviceService"/>
        <property name="paymentDetailsService" ref="service.PaymentDetailsService"/>
	</bean>

    <alias name="service.migHttpService" alias="o2.service.SmsProvider"/>
    <alias name="vf_nz.service.VFNZSMSGatewayService" alias="vf_nz.service.SmsProvider"/>
    <alias name="vf_nz.service.VFNZSMSGatewayService" alias="mtvnz.service.SmsProvider"/>

    <bean id="service.bean.messageNotificationService" class="mobi.nowtechnologies.server.service.impl.DumbMessageNotificationServiceImpl"/>
    <bean id="o2.service.messageNotificationService" class="mobi.nowtechnologies.server.service.impl.O2OAndVFNZMessageNotificationServiceImpl"/>
    <bean id="vf_nz.service.messageNotificationService" class="mobi.nowtechnologies.server.service.impl.O2OAndVFNZMessageNotificationServiceImpl"/>
    <bean id="mtvnz.service.messageNotificationService" class="mobi.nowtechnologies.server.service.impl.MTVNZMessageNotificationServiceImpl"/>

	<bean id="service.O2ClientService" class="mobi.nowtechnologies.server.service.o2.impl.O2ProviderServiceImpl">
		<property name="serverO2Url" value="${o2.server.url}" />
		<property name="promotedServerO2Url" value="${o2.server.promoted.url}" />
		<property name="redeemServerO2Url" value="${o2.server.redeem.url}" />
		<property name="limitValidatePhoneNumber" value="${o2.server.validation.phonenumber.limit}" />
		<property name="redeemPromotedServerO2Url" value="${o2.server.redeem.promoted.url}" />
		<property name="deviceService" ref="service.DeviceService" />
		<property name="userLogRepository" ref="userLogRepository" />
		<property name="communityService" ref="service.communityService" />		
		<property name="webServiceGateway" ref="service.O2WebServiceGateway"/>
        <property name="userService" ref="service.UserService"/>
        <property name="o2Service" ref="service.O2Service"/>

		<property name="subscriberEndpoint" value="${o2.service.endpoint.subscriber_2_0}" />
		<property name="chargeCustomerEndpoint" value="${o2.service.endpoint.chargecustomer_1_0}" />
		<property name="sendMessageEndpoint" value="${o2.service.endpoint.sendmessage_1_1}" />
	</bean>

	<bean id="security.nowTechUserDetailsService" class="org.springframework.security.access.hierarchicalroles.UserDetailsServiceWrapper" />

	<bean id="nowTechBasedRememberMeServices" class="mobi.nowtechnologies.server.security.NowTechTokenBasedRememberMeServices">
		<constructor-arg>
			<value>${rememberMe.key}</value>
		</constructor-arg>
		<constructor-arg>
			<ref bean="security.nowTechUserDetailsService" />
		</constructor-arg>
	</bean>

	<bean id="service.ITunesClient" class="mobi.nowtechnologies.server.service.itunes.impl.ITunesClientImpl">
		<property name="httpOkCode" value="#{T(org.springframework.http.HttpStatus).OK.value()}"/>
		<property name="postService" ref="shared.PostService" />
		<property name="iTunesResponseParser" ref="iTunesResponseParser"/>
	</bean>

	<bean id="service.ITunesService" class="mobi.nowtechnologies.server.service.itunes.impl.ITunesServiceImpl">
		<property name="iTunesClient" ref="service.ITunesClient"/>
		<property name="iTunesPaymentService" ref="service.iTunesPaymentService"/>
		<property name="messageSource" ref="serviceMessageSource"/>
	</bean>
	<bean id="service.iTunesPaymentService" class="mobi.nowtechnologies.server.service.itunes.payment.impl.ITunesPaymentServiceImpl">
		<property name="paymentPolicyService" ref="service.PaymentPolicyService"/>
		<property name="iTunesPaymentLockRepository" ref="ITunesPaymentLockRepository"/>
		<property name="timeService" ref="timeService"/>
		<property name="submittedPaymentService" ref="service.SubmittedPaymentService"/>
	</bean>

	<bean id="iTunesResponseParser" class="mobi.nowtechnologies.server.service.itunes.CompositeITunesResponseParser" />

	<bean id="autoRenewableSubscriptionParser" class="mobi.nowtechnologies.server.service.itunes.impl.JPathReceiptParser">
		<property name="statusPath" value="${itunes.renewable.response.path.status}"/>
		<property name="productIdPath" value="${itunes.renewable.response.path.productId}"/>
		<property name="originalTransactionIdPath" value="${itunes.renewable.response.path.originalTransactionId}"/>
		<property name="expireTimestampPath" value="${itunes.renewable.response.path.expiresDate}"/>
	</bean>
	<bean id="oneTimeSubscriptionParser" class="mobi.nowtechnologies.server.service.itunes.impl.JPathReceiptParser">
		<property name="statusPath" value="${itunes.onetime.response.path.status}"/>
		<property name="productIdPath" value="${itunes.onetime.response.path.productId}"/>
		<property name="originalTransactionIdPath" value="${itunes.onetime.response.path.originalTransactionId}"/>
		<property name="purchaseTimestampPath" value="${itunes.onetime.response.path.purchaseDate}"/>
	</bean>

	<!-- O2 SOA beans -->
	<bean id="service.O2Marshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
        <property name="contextPaths">
        	<list>
				<value>uk.co.o2.soa.chargecustomerdata</value>
				<value>uk.co.o2.soa.subscriberdata</value>
			</list>
        </property>
    </bean>

    <bean id="service.O2TariffService" class="mobi.nowtechnologies.server.service.o2.impl.O2TariffServiceImpl">
        <property name="webServiceGateway" ref="service.O2TariffGateway"/>
        <property name="managePostpayTariffEndpoint" value="${o2.service.endpoint.managepostpaytariffdata_2}" />
        <property name="managePrepayTariffEndpoint" value="${o2.service.endpoint.manageprepaytariffdata_2}" />
        <property name="managePostpayBoltonEndpoint" value="${o2.service.endpoint.managepostpayboltonsdata_2}" />
        <property name="manageOrderEndpoint" value="${o2.service.endpoint.manageorder_2}" />
		<property name="subscriberEndpoint" value="${o2.service.endpoint.subscriber_2_0}" />
    </bean>

    <bean id="service.O2TariffGateway" class="mobi.nowtechnologies.server.service.o2.impl.WebServiceGateway">
        <property name="messageFactory" ref="service.Soap11MessageFactory"/>
        <property name="marshaller" ref="service.O2TariffMarshaller"/>
        <property name="unmarshaller" ref="service.O2TariffMarshaller"/>
        <property name="defaultWebServiceMessageHandler" ref="service.O2WebServiceMessageHandler"/>
        <property name="keystoreLocation" value="${o2.service.security.keystore.url}"/>
        <property name="KeystorePassword" value="${o2.service.security.keystore.password}"/>
    </bean>

    <bean id="service.O2TariffMarshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
        <property name="contextPaths">
            <list>
                <value>uk.co.o2.soa.managepostpaytariffdata_2</value>
                <value>uk.co.o2.soa.manageprepaytariffdata_2</value>
                <value>uk.co.o2.soa.managepostpayboltonsdata_2</value>
				<value>uk.co.o2.soa.manageorderdata_2</value>
                <value>uk.co.o2.soa.subscriberdata_2</value>                
            </list>
        </property>
    </bean>

	<bean id="service.Soap11MessageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory">
		<property name="soapVersion">
            <util:constant static-field="org.springframework.ws.soap.SoapVersion.SOAP_11" />
        </property>
	</bean>
	
	<bean id="service.O2WebServiceGateway" class="mobi.nowtechnologies.server.service.o2.impl.WebServiceGateway">
		<property name="messageFactory" ref="service.Soap11MessageFactory"/>
		<property name="marshaller" ref="service.O2Marshaller"/>
		<property name="unmarshaller" ref="service.O2Marshaller"/>
		<property name="defaultWebServiceMessageHandler" ref="service.O2WebServiceMessageHandler"/>
		<property name="keystoreLocation" value="${o2.service.security.keystore.url}"/>
		<property name="KeystorePassword" value="${o2.service.security.keystore.password}"/>
	</bean>
	
	<bean id="service.O2WebServiceMessageHandler" class="mobi.nowtechnologies.server.service.o2.impl.O2WebServiceMessageHandler">
		<property name="username" value="${o2.service.security.token.username}"/>
		<property name="password" value="${o2.service.security.token.password}"/>        
		<property name="soaConsumerTransactionID" value="${o2.service.security.costumerTransactionId}"/>        
	</bean>

    <bean id="service.OtacValidationService" class="mobi.nowtechnologies.server.service.impl.OtacValidationServiceImpl"/>

    <bean id="service.VFOtacValidationService" class="mobi.nowtechnologies.server.service.impl.VFOtacValidationServiceImpl">
        <property name="userService" ref="service.UserService" />
    </bean>

	   <bean id="imageService" class="mobi.nowtechnologies.server.service.file.image.ImageService" />

	<task:annotation-driven executor="service.Executor"/>
	<task:executor id="service.Executor" pool-size="20"/>
	
	<bean id="service.RestTemplate"  class="org.springframework.web.client.RestTemplate" />

    <bean id="service.ActivationEmailService" class="mobi.nowtechnologies.server.service.ActivationEmailServiceImpl">
        <property name="activationEmailRepository" ref="activationEmailRepository"/>
        <property name="mailService" ref="service.MailService"/>
        <property name="messageSource" ref="serviceMessageSource"/>
        <property name="userService" ref="service.UserService"/>
    </bean>

    <bean id="service.UserPromoService" class="mobi.nowtechnologies.server.service.social.core.UserPromoService"/>

    <bean id="service.AutoOptInRuleService" class="mobi.nowtechnologies.server.user.autooptin.AutoOptInRuleService">
        <property name="configuration" ref="configuration.AutoOptIn"/>
    </bean>

    <bean id="configuration.AutoOptIn" class="mobi.nowtechnologies.server.user.autooptin.AutoOptInConfiguration">
        <property name="subscriptionCampaignRepository" ref="subscriptionCampaignRepository"/>
        <property name="promotionProvider" ref="provider.Promotion"/>
    </bean>

	<bean id="jaxb.NZUserMarshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
		<property name="contextPaths">
			<list>
				<value>nz.co.vodafone.ws.customer.com.service.onlineaccountservice._1</value>
				<value>nz.co.vodafone.ws.fault</value>
			</list>
		</property>
	</bean>

	<bean id="service.NZSubscriberInfoGateway" class="mobi.nowtechnologies.server.service.nz.impl.NZSubscriberInfoGateway">
		<property name="defaultUri" value="${vf.nz.subscriber.service.url}"/>
		<property name="marshaller" ref="jaxb.NZUserMarshaller"/>
		<property name="unmarshaller" ref="jaxb.NZUserMarshaller"/>
		<property name="nzUserId" value="${vf.nz.subscriber.service.user.id}"/>
		<property name="interceptors">
			<list>
				<bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor">
					<property name="securementActions" value="UsernameToken"/>
					<property name="securementUsername" value="${vf.nz.subscriber.service.username}"/>
					<property name="securementPassword" value="${vf.nz.subscriber.service.password}"/>
				</bean>
			</list>
		</property>
	</bean>

	<bean id="service.NZSubscriberInfoService" class="mobi.nowtechnologies.server.service.nz.NZSubscriberInfoService">
		<property name="subscriberInfoProvider" ref="service.NZSubscriberInfoGateway"/>
		<property name="subscriberInfoRepository" ref="NZSubscriberInfoRepository"/>
	</bean>

	<bean id="service.PinCodeService" class="mobi.nowtechnologies.server.service.pincode.impl.PinCodeServiceImpl" depends-on="pinCodeRepository">
		<property name="pinCodeRepository" ref="pinCodeRepository"/>
		<property name="expirationSeconds" value="${pin.code.expiration.seconds}"/>
		<property name="maxAttempts" value="${pin.code.max.attempts}"/>
		<property name="limitSeconds" value="${pin.code.limit.seconds}"/>
		<property name="limitCount" value="${pin.code.limit.count}"/>
	</bean>

    <bean id="configuration.VersionCheckService" class="mobi.nowtechnologies.server.service.versioncheck.VersionCheckService"/>

    <bean id="service.referralService" class="mobi.nowtechnologies.server.service.ReferralService"/>

	<import resource="payment.xml" />

	<import resource="service-application-tests.xml" />
</beans>
