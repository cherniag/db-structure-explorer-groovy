<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring3-3.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
	<head th:include="tpl::head" />

		<body>
			<div th:substituteby="tpl::navbar"></div>
			<div class="container">
			<h1 class="head" th:text="#{chartItems.page.calendar.chooseDay.head.headline}">Chart Items Calendar</h1>
			<form id="addNew" style="padding-left: 25px;">
					<ul class="nav nav-pills table_margin">
						<li class="active">
							<a href="#" th:text="#{chartItems.page.button.chart.edit}" onclick="showChartEditDialog();">Edit Chart</a>
						</li>
					</ul>
			</form>
				<div class="pageWindow simplePopup" id="popupNotificationError">
					<div class="pageWindowContent simpleTextPopup">
						<div class="innerBox">
							<h2 th:text="#{chartItems.page.chartItemsTable.simpleDialog.header}">Header</h2>
							<span th:text="#{chartItems.page.chartItemsTable.simpleDialog.body}">You are trying to save the charts for existing date. Please choose other</span><br /><br />
							<button class="btn btn-primary simplemodal-close" type="button" th:text="#{chartItems.page.chartItemsTable.changeDateTime.submit}">Ok</button>
						</div>
					</div>
				</div>
				<div class="newsList">
					<ul  class="table">
						<li class="title">
								<div class="position_chartItem" th:text="#{chartItems.page.chartItemsTable.head.position}">Position</div>
								<div class="image_chartItem" th:text="#{chartItems.page.chartItemsTable.head.image}">Image</div>
								<div class="channel_chartItem" th:text="#{chartItems.page.chartItemsTable.head.channel}">Channel</div>
								<div class="ArtistTitle_chartItem" th:text="#{chartItems.page.chartItemsTable.head.artistTitle}">Artist-Title</div>
								<div class="info_chartItem" th:text="#{chartItems.page.chartItemsTable.head.info}">Info</div>
								<div class="publishDate_chartItem" th:text="#{chartItems.page.chartItemsTable.head.publishTime}">Publish Date</div>
						</li>
					</ul>
					<ul class="table table_up" id="sortable">
						
						<li th:each="chartItemDto, it: ${CHART_ITEM_DTO_LIST}">
							<div class="position_chartItem" th:text="${it.index+1}">1</div>
							<div class="image_chartItem">
								<img alt="Chart item media picture" src=""
									th:attr="src=@{__${filesURL+chartItemDto.mediaDto.imageFileSmallDto.filename}__}"
									th:alt="#{chartItems.page.chartItemsTable.chart.media.img.alt}"
									width="50" height="50" />
							</div>
							<div class="channel_chartItem" th:text="${chartItemDto.channel}">HEATSEEKER</div>
							<div class="ArtistTitle_chartItem">
								<span th:text="${chartItemDto.mediaDto.artistDto.name} + ' - ' + ${chartItemDto.mediaDto.title}">Led Zeppelin - Kashmir</span><br/><br />
							</div>

							<div class="info_chartItem" th:text="${chartItemDto.info}">
								"Kashmir" is a song by the English rock band Led Zeppelin from
								their sixth album Physical Graffiti, released in 1975. It was
								written by Jimmy Page and Robert Plant (with contributions from
								John Bonham) over a period of three years, with the lyrics
								dating back to 1973.
							</div>

							<div class="publishDate_chartItem" th:text="${#dates.format(chartItemDto.publishTime, '__#{chartItems.publishDate.format}__')}">12/06/2012 12:00:00</div>
							
						</li>
					</ul>
				</div>
				
				<div class="newsCalendar">
					<h2 th:text="#{chartItems.page.chartItemsTable.calendar.headline}">Select Date1</h2>
					<div id="datepicker" class="datepicker"></div><br/><br/>
				</div><br/><br/>
				
				<div class="newsCalendar">
					<h2 th:text="#{chartItems.page.chartItemsTable.existingCharts.headline}">Updates list</h2>
					<div th:each="updateTime : ${allPublishTimeMillis}" th:if="${#dates.format(new java.util.Date(updateTime), 'dd/MMM/yyyy').startsWith(#dates.format(selectedDateTime,'dd/MMM/yyyy'))}" class="updateButton">
						<form class="edit_btn" th:action="@{/chartsNEW/__${chartId}__/__${#dates.format(new java.util.Date(updateTime), 'yyyy-MM-dd_HH:mm:ss')}__/}" method="get">
							<button class="btn btn-primary updatesList" type="submit" th:text="${#dates.format(new java.util.Date(updateTime), 'HH:mm')}">Edit for this time</button>
						</form>
						<form id="deleteChartItemsSetForm" class="del_btn" th:action="@{/charts/__${chartId}__/__${#dates.format(new java.util.Date(updateTime), 'yyyy-MM-dd_HH:mm:ss')}__}" method="post" th:if="${!#lists.isEmpty(CHART_ITEM_DTO_LIST)}">
							<input type="hidden" id="_method" name="_method" value="DELETE" />
								<a href="#" onCLick="$('form#deleteChartItemsSetForm').submit();"><img th:src="@{/assets/img/icon_delete.png}"
									th:alt="#{chartItems.page.deleteChartItemsSetForm.submit.text}"
									width="32" height="32" /></a>
						</form>
					</div>
				</div><br/><br/>
				
				<form class="newsCalendar paddingTop" id="createChartUpdateForm" method="get">
					<h2 th:text="#{chartItems.page.chartItemsTable.timepicker.headline}">Add Update</h2>
				    <p>Set a new update for: </p>
					<input type="hidden" name="changePosition" value="true" />
				    <input class="u" type="text" style="width: 70px" id="timepicker_customrange" />
					<button class="u_btn" type="submit" value="Edit Chart">Add</button>
				</form><br/><br/>
								
			</div>
			
				<div id="chart-edit-dialog" class="modal hide fade" aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" style="display: none;">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h3 id="myModalLabel">Edit Chart</h3>
					</div>
					<div class="modal-body" style="width:530px">
						<form id="chart-edit-form" action="#" th:action="@{'/charts/'+${chart.id}}" method="post"
						enctype="multipart/form-data" accept-charset="UTF-8">
							<div class="control-group">
								<input type="hidden" name="id"/> 
								<input type="hidden" name="name"/>
								<input type="hidden" name="imageFileName"/>
								<div class="filtersSelect">
									<div id="selectImageDiv">
										<label><strong th:text="#{chartItems.page.chart.edit.dialog.item.image}">Select Image:</strong></label>
										<img class="addedImage" src="###" width="240" height="180"/>
										<br/><br/>
										<input id="file" name="file" type="file" accept="image"/>
									</div>
								</div>
								<label><strong th:text="#{chartItems.page.chart.edit.dialog.item.subtitle}">Subtitle:</strong></label>
								<input type="text" name="subtitle" style="width:98%;"/>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button class="btn btn-primary" data-dismiss="modal" aria-hidden="true" onclick="onSaveChart();">Save</button>
						<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
					</div>
				</div>
			
			<script type="text/javascript" th:inline="javascript">/*<![CDATA[*/
			var filesURL = /*[[@{__${chartFilesURL}__/}]]*/ 'url';			                                                                 
			var chart = {};
			chart.id = /*[[${chart.id}]]*/ '1';
			chart.name = /*[[${chart.name}]]*/ 'name';
			chart.subtitle = /*[[${chart.subtitle}]]*/ 'subtitle';
			chart.imageFileName = /*[[${chart.imageFileName}]]*/ 'imageFileName';
			                                                                 
			function showChartEditDialog() {
				
				var id = chart.id;
				var name = chart.name;
				var subtitle = chart.subtitle;
				var imageFileName = chart.imageFileName;
				var imageFileUrl = filesURL+imageFileName;
				
				var chartEditForm = $("form#chart-edit-form");
				chartEditForm.find("input[name='id']").val(id);
				chartEditForm.find("input[name='name']").val(name);
				chartEditForm.find("input[name='subtitle']").val(subtitle);
				chartEditForm.find("input[name='imageFileName']").val(imageFileName);
				chartEditForm.find(".addedImage").attr('src', imageFileUrl);
				
				$("#chart-edit-dialog").modal("show");
			};
			
			function onSaveChart() {
				var chartEditForm = $("form#chart-edit-form");
				chartEditForm.submit();
			};	
			
			$(function() {
				var url = /*[[@{'/charts/'+${chartId}+'.json'}]]*/ '';
				$.ajax({
					url:url,
					contentType:'application/json',
					success: function(data) {
						var dates = [];
						for (d in data.allPublishTimeMillis) {
							dates.push(new Date(data.allPublishTimeMillis[d]));
		            	}
						
						$( "#datepicker" ).datepicker({
							dateFormat : 'yy-mm-dd',
							beforeShowDay: function (date) {
								for (var i = 0; i < dates.length; i++) {
								    if (
								    (dates[i].getDate() == date.getDate()) &&
								    (dates[i].getMonth() == date.getMonth()) &&
								    (dates[i].getFullYear() == date.getFullYear())
								    ) {
								        return [true,'highlight', ''];
								    }
								}
								return [true, '',''];
							},
	    
							onSelect: function(dateText) {
								if ((new Date()).setHours(0,0,0,0) == (new Date(dateText)).setHours(0,0,0,0)) {
									location.href = /*[[@{'/charts/'+${chartId}}]]*/ '';
								} else {
								  	var href= /*[[@{'/charts/'+${chartId}(selectedPublishDateTime=${dateText})}]]*/ '';
								    location.href = href+dateText+"_00:00:00";
								}
							}
						});
						
						
						var selectedDate=jAdmin.getURLParameter("selectedPublishDateTime").substring(0, 10);
						if (null!=selectedDate)
							$('.datepicker').datepicker("setDate" , selectedDate);
					}
				});
				
				
				$('#timepicker_customrange').timepicker({
				    minutes: { interval: 15 },
				    showCloseButton: true,
				    rows: 3,
				    showPeriodLabels: true,
				    minuteText: 'Min',
				    onSelect: function(newTime, inst) {
				    	var href= /*[[@{'/chartsNEW/'+${chartId} + '/' + ${#dates.format(selectedDateTime,'yyyy-MM-dd')}+'_' }]]*/ '';
				    	$('#createChartUpdateForm').attr('action', href+newTime+':00');
				    }
				});
				
				
			  });
			/*]]>*/</script>
		</body>
</html>